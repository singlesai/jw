"use strict";(self["webpackChunktico_yt_mobile"]=self["webpackChunktico_yt_mobile"]||[]).push([[421],{6421:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var i=a(537),r=a(5380);function d(e,t,a,d,l,o){const n=(0,i.up)("van-icon"),s=(0,i.up)("van-nav-bar"),u=(0,i.up)("van-cell"),c=(0,i.up)("van-calendar"),h=(0,i.up)("van-field"),m=(0,i.up)("van-tab"),_=(0,i.up)("van-tabs"),p=(0,i.up)("van-divider"),v=(0,i.up)("van-tag"),y=(0,i.up)("van-card"),w=(0,i.up)("van-action-bar-button"),g=(0,i.up)("van-action-bar"),k=(0,i.up)("van-action-sheet");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(s,{"left-text":"返回","left-arrow":"",title:l.title,onClickLeft:t[0]||(t[0]=t=>e.$router.go(-1)),onClickRight:o.onClickRight},{right:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"ellipsis",size:"18"})])),_:1},8,["title","onClickRight"]),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m,{title:"发货信息"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{value:l.data.strSendDate,title:"发货日期",onClick:t[1]||(t[1]=e=>l.show=!0)},null,8,["value"]),(0,i.Wm)(c,{show:l.show,"onUpdate:show":t[2]||(t[2]=e=>l.show=e),onConfirm:o.onSelDate},null,8,["show","onConfirm"]),(0,i.Wm)(h,{modelValue:l.data.carNo,"onUpdate:modelValue":t[3]||(t[3]=e=>l.data.carNo=e),required:"",label:"车牌号"},null,8,["modelValue"]),(0,i.Wm)(h,{modelValue:l.data.driverName,"onUpdate:modelValue":t[4]||(t[4]=e=>l.data.driverName=e),required:"",label:"司机姓名"},null,8,["modelValue"]),(0,i.Wm)(h,{modelValue:l.data.driverPhone,"onUpdate:modelValue":t[5]||(t[5]=e=>l.data.driverPhone=e),required:"",label:"司机电话"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(m,{title:"收货信息"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{title:"收货单位",value:l.data.customer_id?l.data.customer_id[1]:""},null,8,["value"]),(0,i.Wm)(u,{title:"收货地址",value:l.data.consignee_address?l.data.consignee_address:""},null,8,["value"]),(0,i.Wm)(u,{title:"项目名称",value:l.data.project_id?l.data.project_id[1]:""},null,8,["value"]),(0,i.Wm)(u,{title:"收货人",value:(l.data.consignee?l.data.consignee:"")+"-"+(l.data.consignee_phone?l.data.consignee_phone:"")},null,8,["value"])])),_:1})])),_:1}),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("明细")])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.entry,((e,t)=>((0,i.wg)(),(0,i.j4)(y,{key:t,num:e.product_uom_qty+e.product_uom[1],price:e.online_price,title:e.code,desc:e.product_id[1]},{tags:(0,i.w5)((()=>[(0,i.Wm)(v,{plain:""},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.name),1)])),_:2},1024),(0,i.Wm)(v,{plain:""},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.texture),1)])),_:2},1024),0!==l.id&&e.note?((0,i.wg)(),(0,i.j4)(v,{key:0,plain:""},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.note),1)])),_:2},1024)):(0,i.kq)("",!0)])),footer:(0,i.w5)((()=>[0===l.id?((0,i.wg)(),(0,i.j4)(h,{key:0,label:"实发数量",modelValue:e.qty,"onUpdate:modelValue":t=>e.qty=t,type:"number"},null,8,["modelValue","onUpdate:modelValue"])):(0,i.kq)("",!0),0===l.id?((0,i.wg)(),(0,i.j4)(h,{key:1,label:"备注",modelValue:e.note,"onUpdate:modelValue":t=>e.note=t},null,8,["modelValue","onUpdate:modelValue"])):(0,i.kq)("",!0)])),_:2},1032,["num","price","title","desc"])))),128)),0===l.id?((0,i.wg)(),(0,i.j4)(g,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{text:"提交",type:"danger",onClick:o.onSubmit},null,8,["onClick"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(k,{show:l.showAct,"onUpdate:show":t[6]||(t[6]=e=>l.showAct=e),actions:l.actions,onSelect:o.onAct},null,8,["show","actions","onSelect"])])}a(6513);var l=a(8875),o=a(1552),n=a(2420),s={name:"recRec",data(){return{title:"发货-新增",id:0,sid:0,data:{},entry:[],show:!1,showAct:!1,actions:[{name:"删除"},{name:"列表"}]}},mounted(){this.load()},methods:{async load(){l.F.loading({forbidClick:!0,duration:0});try{if(this.$route.query.sid){this.sid=parseInt(this.$route.query.sid);var e=await n.Z.model("purchase.order").read([this.sid]);if(e.length>0){this.data=e[0],this.entry=await n.Z.model("purchase.order.line").read(this.data.order_line);var t=await n.Z.model("res.partner").read(this.data.partner_id[0],["property_stock_supplier"]);this.data.stock=t[0].property_stock_supplier;var a=await n.Z.model("res.partner").read(this.data.customer_id[0],["property_stock_customer"]);this.data.recStock=a[0].property_stock_customer}this.actions=[{name:"列表"}]}else{if(this.id=parseInt(this.$route.query.id),e=await n.Z.model("delivery.waybill").read([this.id]),e.length>0){e=e[0],this.sid=e.purchase_order_id[0],this.title="发货-"+e.name,e.strSendDate=e.delivery_date||"",e.carNo=e.car_number||"",e.driverName=e.driver||"",e.driverPhone=e.driver_phone||"",e.partner_id=e.supplier_id,e.stock=e.location_id,e.recStock=e.location_dest_id,this.data=e;var i=await n.Z.model("delivery.waybill.line").read(this.data.delivery_waybill_line_ids);for(var r in i)i[r].qty=i[r].factory_qty,i[r].product_uom_qty=i[r].factory_qty,i[r].product_uom=i[r].uom_id,i[r].note=i[r].remark,i[r].name=i[r].brand_id[1];this.entry=i}this.actions=[{name:"删除"},{name:"列表"}]}l.F.clear()}catch(d){l.F.clear(),l.F.fail(d.message||d)}},onClickRight(){this.showAct=!0},onDelete(){o.V.confirm({title:"删除",message:"确定删除记录？"}).then((()=>{l.F.loading({forbidClick:!0,duration:0}),n.Z.model("delivery.waybill").unlink([this.id]).then((()=>{l.F.clear(),this.$router.go(-1)})).catch((e=>{l.F.clear(),l.F.fail(e.message||e)}))})).catch((()=>{}))},onAct(e){switch(e.name){case"删除":this.onDelete();break;case"列表":this.$router.push("./sendlist?sid="+this.sid);break}},onSelDate(e){this.show=!1;var t="00"+(e.getMonth()+1);t=t.substring(t.length-2,t.length);var a="00"+e.getDate();a=a.substring(a.length-2,a.len),this.data.strSendDate=`${e.getFullYear()}-${t}-${a}`,this.data.sendDate=e},async onSubmit(){try{if(!this.data.strSendDate)throw"请输入发货日期";if(!this.data.carNo)throw"请输入车牌号";if(!this.data.driverName)throw"请输入司机姓名";if(!this.data.driverPhone)throw"请输入司机 电话";var e={purchase_order_id:this.sid,sale_contract_id:this.data.sale_contract_id[0],delivery_date:this.data.strSendDate,receive_date:this.data.strSendDate,car_number:this.data.carNo,driver:this.data.driverName,driver_phone:this.data.driverPhone,supplier_id:this.data.partner_id[0],location_id:this.data.stock[0],location_dest_id:this.data.recStock[0],delivery_waybill_line_ids:[]};for(var t in this.entry){var a=this.entry[t];a.qty>0&&e.delivery_waybill_line_ids.push([0,!1,{product_id:a.product_id[0],delivery_address:a.delivery_address[0],factory_qty:a.qty,qty:a.qty,remark:a.note}])}if(e.delivery_waybill_line_ids.length<=0)throw"请输入签收数量";l.F.loading({forbidClick:!0,duration:0});try{0===this.id?this.id=await n.Z.model("delivery.waybill").create(e):await n.Z.model("delivery.waybill").write([this.id],e),this.$router.go(-1)}catch(i){l.F.clear(),l.F.fail(i.message||i)}}catch(i){l.F.fail(i.message||i)}}}},u=a(3169);const c=(0,u.Z)(s,[["render",d]]);var h=c}}]);
//# sourceMappingURL=421.bf027222.js.map